{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing connection records within a FastAPI application. It includes route handlers for listing, creating/updating, validating, revoking connections, and token management, along with related data models and associated imports.", "external_files": ["src.connectors.registry", "src.models.collections", "src.models.schemas", "src.core.errors"], "external_methods": ["upsert_connection", "store_token", "fetch_token_plaintext", "put_sync_state", "get_sync_state", "append_audit", "to_http_exception"], "published": ["list_connections", "upsert_connection_route", "persist_token", "validate_connection", "revoke_connection", "get_token", "get_sync_cursor", "put_sync_cursor"], "classes": [{"name": "UpsertConnectionRequest", "description": "Pydantic model for request data to create or update a connection."}, {"name": "PersistTokenRequest", "description": "Pydantic model for request data to store a token."}, {"name": "ValidateConnectionRequest", "description": "Pydantic model for request data to validate a connection."}, {"name": "RevokeConnectionRequest", "description": "Pydantic model for request data to revoke a connection."}, {"name": "Envelope", "description": "Schema for wrapping API responses, imported from src.models.schemas."}], "methods": [{"name": "Envelope list_connections( workspaceId: Optional[str] = Query(default=None, description=\"Filter by workspace id\"), connectorId: Optional[str] = Query(default=None, description=\"Filter by connector id\"), )", "description": "Returns a list of connection records with optional filters; currently a scaffold that returns an empty list.", "scope": "", "scopeKind": ""}, {"name": "Envelope upsert_connection_route(req: UpsertConnectionRequest)", "description": "Creates or updates a connection record, also logs an audit event.", "scope": "", "scopeKind": ""}, {"name": "Envelope persist_token(req: PersistTokenRequest)", "description": "Encrypts and stores a connection token, then logs an audit event.", "scope": "", "scopeKind": ""}, {"name": "Envelope validate_connection(req: ValidateConnectionRequest)", "description": "Validates the connection configuration via the specified connector.", "scope": "", "scopeKind": ""}, {"name": "Envelope revoke_connection(req: RevokeConnectionRequest)", "description": "Revoke a connection, logs the event; placeholder implementation.", "scope": "", "scopeKind": ""}, {"name": "Envelope get_token(connection_id: str)", "description": "Fetches the latest plaintext token for a connection.", "scope": "", "scopeKind": ""}, {"name": "Envelope get_sync_cursor(connection_id: str)", "description": "Retrieves the current sync state/cursor for a connection.", "scope": "", "scopeKind": ""}, {"name": "Envelope put_sync_cursor(connection_id: str, body: Dict[str, Any] = Body(default_factory=dict))", "description": "Updates the sync state/cursor for a connection.", "scope": "", "scopeKind": ""}], "calls": ["upsert_connection", "append_audit", "store_token", "fetch_token_plaintext", "get_sync_state", "put_sync_state"], "search-terms": ["connections", "API routes", "connection token", "sync state", "revoke", "validate", "FastAPI", "src.connectors.registry", "src.models.collections", "src.models.schemas"], "state": 2, "file_id": 17, "knowledge_revision": 64, "git_revision": "cd574c5a40a5fd16928fbf79ba72f8bf801473f3", "revision_history": [{"35": ""}, {"50": ""}, {"61": "bd31475813d25d18f20aff49f24e24df16edecf9"}, {"64": "cd574c5a40a5fd16928fbf79ba72f8bf801473f3"}], "ctags": [{"_type": "tag", "name": "PersistTokenRequest", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^class PersistTokenRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "RevokeConnectionRequest", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^class RevokeConnectionRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UpsertConnectionRequest", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^class UpsertConnectionRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ValidateConnectionRequest", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^class ValidateConnectionRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    config: Dict[str, Any] = Field(default_factory=dict)$/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "ValidateConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    config: Dict[str, Any] = Field(default_factory=dict, description=\"Connection configuration\")$/", "language": "Python", "typeref": "typename:Dict[str, Any]", "kind": "variable", "scope": "UpsertConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "connectionId", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    connectionId: str = Field(..., description=\"Connection id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PersistTokenRequest", "scopeKind": "class"}, {"_type": "tag", "name": "connectionId", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    connectionId: str = Field(..., description=\"Connection id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "RevokeConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "connectionId", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    connectionId: str = Field(..., description=\"Connection id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "ValidateConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "connectorId", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    connectorId: str = Field(..., description=\"Connector id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UpsertConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "expiresAt", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    expiresAt: Optional[str] = Field(default=None, description=\"Optional ISO8601 expiry\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "PersistTokenRequest", "scopeKind": "class"}, {"_type": "tag", "name": "get_sync_cursor", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def get_sync_cursor(connection_id: str) -> Envelope:$/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(connection_id: str)"}, {"_type": "tag", "name": "get_token", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def get_token(connection_id: str) -> Envelope:$/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(connection_id: str)"}, {"_type": "tag", "name": "list_connections", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def list_connections($/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "( workspaceId: Optional[str] = Query(default=None, description=\"Filter by workspace id\"), connectorId: Optional[str] = Query(default=None, description=\"Filter by connector id\"), )"}, {"_type": "tag", "name": "name", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    name: str = Field(..., description=\"Connection name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UpsertConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "persist_token", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def persist_token(req: PersistTokenRequest) -> Envelope:$/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(req: PersistTokenRequest)"}, {"_type": "tag", "name": "put_sync_cursor", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def put_sync_cursor(connection_id: str, body: Dict[str, Any] = Body(default_factory=dict))/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(connection_id: str, body: Dict[str, Any] = Body(default_factory=dict))"}, {"_type": "tag", "name": "reason", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    reason: Optional[str] = Field(default=None)$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "RevokeConnectionRequest", "scopeKind": "class"}, {"_type": "tag", "name": "revoke_connection", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def revoke_connection(req: RevokeConnectionRequest) -> Envelope:$/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(req: RevokeConnectionRequest)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^router = APIRouter(prefix=\"\\/connections\", tags=[\"Connections\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    token: str = Field(..., description=\"Access token or API key\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PersistTokenRequest", "scopeKind": "class"}, {"_type": "tag", "name": "upsert_connection_route", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def upsert_connection_route(req: UpsertConnectionRequest) -> Envelope:$/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(req: UpsertConnectionRequest)"}, {"_type": "tag", "name": "validate_connection", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^async def validate_connection(req: ValidateConnectionRequest) -> Envelope:$/", "language": "Python", "typeref": "typename:Envelope", "kind": "function", "signature": "(req: ValidateConnectionRequest)"}, {"_type": "tag", "name": "workspaceId", "path": "/home/kavia/workspace/code-generation/unified-connector-framework-143961-143970/unified_connector_backend/src/api/routes/connections.py", "pattern": "/^    workspaceId: str = Field(..., description=\"Workspace id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "UpsertConnectionRequest", "scopeKind": "class"}], "hash": "d5de4198b94ff8d9a465448c77b9c92d", "format-version": 4, "code-base-name": "unified_connector_backend", "filename": "unified_connector_backend/src/api/routes/connections.py", "fields": [{"name": "Dict[str, Any] config", "scope": "ValidateConnectionRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str connectionId", "scope": "PersistTokenRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str connectorId", "scope": "UpsertConnectionRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] expiresAt", "scope": "PersistTokenRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str name", "scope": "UpsertConnectionRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] reason", "scope": "RevokeConnectionRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/connections\", tags=[\"Connections\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str token", "scope": "PersistTokenRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str workspaceId", "scope": "UpsertConnectionRequest", "scopeKind": "class", "description": "unavailable"}]}